<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.mingi.mapper.CommentMapper">
	
	<select id="getCommentList" resultType="kr.mingi.entity.Comment">
    SELECT * FROM smgComment WHERE BoardIdx = #{boardIdx} 
    ORDER BY 
        CASE 
            WHEN parentIdx IS NULL THEN 0 <!-- 부모 댓글 우선 -->
            ELSE 1 
        END, 
        COALESCE(parentIdx, commentIdx) ASC, <!-- 부모 댓글은 최신순 -->
        indate ASC <!-- 대댓글은 생성순으로 정렬 -->
    ${sortOrder}
	</select>
	
	<!-- 댓글작성: 1차댓글은 서비스에서 vo.setCommentLevel을 1로 고정, 대댓글은 부모댓글 레벨 확인 후 +1  -->
	<insert id="insertComment" parameterType="kr.mingi.entity.Comment">
		INSERT INTO smgComment (memID, comment, boardIdx, parentIdx) <!-- 명시적으로 써주는게 좋다 -->
		VALUES (#{memID}, #{comment}, #{boardIdx}, #{parentIdx}) 			 
	</insert>

</mapper>